{"ast":null,"code":"import { createClient } from '@supabase/supabase-js';\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseKey = process.env.REACT_APP_SUPABASE_KEY;\nif (!supabaseUrl || !supabaseKey) {\n  throw new Error('Manglende Supabase miljøvariabler');\n}\nconsole.log('Initializing Supabase client with URL:', supabaseUrl);\nexport const supabase = createClient(supabaseUrl, supabaseKey, {\n  auth: {\n    persistSession: false\n  }\n});\n\n// Fetch all course data from original table\nexport const fetchAllCourses = async () => {\n  try {\n    console.log('Fetching all courses from Supabase');\n    const {\n      data,\n      error\n    } = await supabase.from('courses').select('*');\n    if (error) {\n      console.error('Supabase error:', error);\n      throw error;\n    }\n    console.log('Sample course data structure:', data[0]);\n    console.log(`Fetched ${data.length} courses`);\n    return data;\n  } catch (error) {\n    console.error('Error fetching courses:', error);\n    throw error;\n  }\n};\n\n// Create new table for OpenAI embeddings\nexport const createOpenAIEmbeddingsTable = async () => {\n  try {\n    const {\n      error\n    } = await supabase.rpc('create_openai_embeddings_table');\n    if (error) {\n      console.error('Error creating table:', error);\n      throw error;\n    }\n    console.log('Successfully created openai_embeddings table');\n  } catch (error) {\n    console.error('Error in createOpenAIEmbeddingsTable:', error);\n    throw error;\n  }\n};\n\n// Store course with OpenAI embedding\nexport const storeCourseWithEmbedding = async (courseData, embedding) => {\n  try {\n    const {\n      error\n    } = await supabase.from('openai_embeddings').insert([{\n      kurskode: courseData.kurskode,\n      kursnavn: courseData.kursnavn,\n      credits: courseData.credits,\n      level_of_study: courseData.level_of_study,\n      academic_coordinator: courseData.academic_coordinator,\n      ansvarlig_institutt: courseData.ansvarlig_institutt,\n      ansvarlig_område: courseData.ansvarlig_område,\n      undv_språk: courseData.undv_språk,\n      portfolio: courseData.portfolio,\n      learning_outcome_knowledge: courseData.learning_outcome_knowledge,\n      learning_outcome_skills: courseData.learning_outcome_skills,\n      learning_outcome_general_competence: courseData.learning_outcome_general_competence,\n      course_content: courseData.course_content,\n      embedding: embedding\n    }]);\n    if (error) {\n      console.error('Error storing course with embedding:', error);\n      throw error;\n    }\n    console.log(`Successfully stored course ${courseData.kurskode} with OpenAI embedding`);\n  } catch (error) {\n    console.error(`Error storing course ${courseData.kurskode}:`, error);\n    throw error;\n  }\n};\n\n// Fetch courses with OpenAI embeddings\nexport const fetchOpenAIEmbeddings = async () => {\n  try {\n    console.log('Fetching courses with OpenAI embeddings');\n    const {\n      data,\n      error\n    } = await supabase.from('openai_embeddings').select('*');\n    if (error) {\n      console.error('Supabase error:', error);\n      throw error;\n    }\n    const processedCourses = data.map(course => ({\n      ...course,\n      embedding: typeof course.embedding === 'string' ? JSON.parse(course.embedding) : course.embedding\n    }));\n    console.log(`Fetched ${processedCourses.length} courses with OpenAI embeddings`);\n    return processedCourses;\n  } catch (error) {\n    console.error('Error fetching OpenAI embeddings:', error);\n    throw error;\n  }\n};\nexport const fetchStoredEmbeddings = async () => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('courses').select(`\n                kurskode,\n                kursnavn,\n                course_content,\n                learning_outcome_knowledge,\n                learning_outcome_skills,\n                learning_outcome_general_competence,\n                embeddings_no,\n                embeddings_en,\n                credits,\n                level_of_study,\n                undv_språk,\n                link_nb\n            `);\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error('Error fetching stored embeddings:', error);\n    throw error;\n  }\n};\nexport const updateCourseEmbedding = async (courseCode, embedding) => {\n  try {\n    console.log('Updating embedding for course:', courseCode);\n    const {\n      error\n    } = await supabase.from('courses').update({\n      embedding\n    }).eq('kurskode', courseCode);\n    if (error) {\n      console.error('Supabase error:', {\n        message: error.message,\n        details: error.details,\n        hint: error.hint,\n        code: error.code\n      });\n      throw error;\n    }\n    console.log('Successfully updated embedding');\n  } catch (error) {\n    console.error('Detailed error in updateCourseEmbedding:', {\n      message: error.message,\n      stack: error.stack\n    });\n    throw error;\n  }\n};\nexport const checkIsAdmin = async () => {\n  try {\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) {\n      console.log('No user found');\n      return false;\n    }\n    console.log('Checking admin status for user:', user.id);\n    const {\n      data,\n      error\n    } = await supabase.from('user_roles').select('is_admin').eq('user_id', user.id).single();\n    if (error) {\n      console.error('Database error:', error);\n      throw error;\n    }\n    console.log('Admin check result:', data);\n    return (data === null || data === void 0 ? void 0 : data.is_admin) || false;\n  } catch (error) {\n    console.error('Detailed error in checkIsAdmin:', error);\n    return false;\n  }\n};","map":{"version":3,"names":["createClient","supabaseUrl","process","env","REACT_APP_SUPABASE_URL","supabaseKey","REACT_APP_SUPABASE_KEY","Error","console","log","supabase","auth","persistSession","fetchAllCourses","data","error","from","select","length","createOpenAIEmbeddingsTable","rpc","storeCourseWithEmbedding","courseData","embedding","insert","kurskode","kursnavn","credits","level_of_study","academic_coordinator","ansvarlig_institutt","ansvarlig_område","undv_språk","portfolio","learning_outcome_knowledge","learning_outcome_skills","learning_outcome_general_competence","course_content","fetchOpenAIEmbeddings","processedCourses","map","course","JSON","parse","fetchStoredEmbeddings","updateCourseEmbedding","courseCode","update","eq","message","details","hint","code","stack","checkIsAdmin","user","getUser","id","single","is_admin"],"sources":["C:/Users/A1510207/OneDrive - BI Norwegian Business School (BIEDU)/Documents/Dev prosjekter/SWAAKON-React/src/services/supabase.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\r\nconst supabaseKey = process.env.REACT_APP_SUPABASE_KEY;\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    throw new Error('Manglende Supabase miljøvariabler');\r\n}\r\n\r\nconsole.log('Initializing Supabase client with URL:', supabaseUrl);\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey, {\r\n    auth: {\r\n        persistSession: false\r\n    }\r\n});\r\n\r\n// Fetch all course data from original table\r\nexport const fetchAllCourses = async () => {\r\n    try {\r\n        console.log('Fetching all courses from Supabase');\r\n        const { data, error } = await supabase\r\n            .from('courses')\r\n            .select('*');\r\n\r\n        if (error) {\r\n            console.error('Supabase error:', error);\r\n            throw error;\r\n        }\r\n\r\n        console.log('Sample course data structure:', data[0]);\r\n        console.log(`Fetched ${data.length} courses`);\r\n        return data;\r\n    } catch (error) {\r\n        console.error('Error fetching courses:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// Create new table for OpenAI embeddings\r\nexport const createOpenAIEmbeddingsTable = async () => {\r\n    try {\r\n        const { error } = await supabase\r\n            .rpc('create_openai_embeddings_table');\r\n\r\n        if (error) {\r\n            console.error('Error creating table:', error);\r\n            throw error;\r\n        }\r\n        console.log('Successfully created openai_embeddings table');\r\n    } catch (error) {\r\n        console.error('Error in createOpenAIEmbeddingsTable:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// Store course with OpenAI embedding\r\nexport const storeCourseWithEmbedding = async (courseData, embedding) => {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('openai_embeddings')\r\n            .insert([{\r\n                kurskode: courseData.kurskode,\r\n                kursnavn: courseData.kursnavn,\r\n                credits: courseData.credits,\r\n                level_of_study: courseData.level_of_study,\r\n                academic_coordinator: courseData.academic_coordinator,\r\n                ansvarlig_institutt: courseData.ansvarlig_institutt,\r\n                ansvarlig_område: courseData.ansvarlig_område,\r\n                undv_språk: courseData.undv_språk,\r\n                portfolio: courseData.portfolio,\r\n                learning_outcome_knowledge: courseData.learning_outcome_knowledge,\r\n                learning_outcome_skills: courseData.learning_outcome_skills,\r\n                learning_outcome_general_competence: courseData.learning_outcome_general_competence,\r\n                course_content: courseData.course_content,\r\n                embedding: embedding\r\n            }]);\r\n\r\n        if (error) {\r\n            console.error('Error storing course with embedding:', error);\r\n            throw error;\r\n        }\r\n        console.log(`Successfully stored course ${courseData.kurskode} with OpenAI embedding`);\r\n    } catch (error) {\r\n        console.error(`Error storing course ${courseData.kurskode}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// Fetch courses with OpenAI embeddings\r\nexport const fetchOpenAIEmbeddings = async () => {\r\n    try {\r\n        console.log('Fetching courses with OpenAI embeddings');\r\n        const { data, error } = await supabase\r\n            .from('openai_embeddings')\r\n            .select('*');\r\n\r\n        if (error) {\r\n            console.error('Supabase error:', error);\r\n            throw error;\r\n        }\r\n\r\n        const processedCourses = data.map(course => ({\r\n            ...course,\r\n            embedding: typeof course.embedding === 'string' ?\r\n                JSON.parse(course.embedding) : course.embedding\r\n        }));\r\n\r\n        console.log(`Fetched ${processedCourses.length} courses with OpenAI embeddings`);\r\n        return processedCourses;\r\n    } catch (error) {\r\n        console.error('Error fetching OpenAI embeddings:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const fetchStoredEmbeddings = async () => {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('courses')\r\n            .select(`\r\n                kurskode,\r\n                kursnavn,\r\n                course_content,\r\n                learning_outcome_knowledge,\r\n                learning_outcome_skills,\r\n                learning_outcome_general_competence,\r\n                embeddings_no,\r\n                embeddings_en,\r\n                credits,\r\n                level_of_study,\r\n                undv_språk,\r\n                link_nb\r\n            `);\r\n\r\n        if (error) throw error;\r\n        return data;\r\n    } catch (error) {\r\n        console.error('Error fetching stored embeddings:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const updateCourseEmbedding = async (courseCode, embedding) => {\r\n    try {\r\n        console.log('Updating embedding for course:', courseCode);\r\n        const { error } = await supabase\r\n            .from('courses')\r\n            .update({ embedding })\r\n            .eq('kurskode', courseCode);\r\n\r\n        if (error) {\r\n            console.error('Supabase error:', {\r\n                message: error.message,\r\n                details: error.details,\r\n                hint: error.hint,\r\n                code: error.code\r\n            });\r\n            throw error;\r\n        }\r\n\r\n        console.log('Successfully updated embedding');\r\n    } catch (error) {\r\n        console.error('Detailed error in updateCourseEmbedding:', {\r\n            message: error.message,\r\n            stack: error.stack\r\n        });\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const checkIsAdmin = async () => {\r\n    try {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) {\r\n            console.log('No user found');\r\n            return false;\r\n        }\r\n\r\n        console.log('Checking admin status for user:', user.id);\r\n\r\n        const { data, error } = await supabase\r\n            .from('user_roles')\r\n            .select('is_admin')\r\n            .eq('user_id', user.id)\r\n            .single();\r\n\r\n        if (error) {\r\n            console.error('Database error:', error);\r\n            throw error;\r\n        }\r\n\r\n        console.log('Admin check result:', data);\r\n        return data?.is_admin || false;\r\n    } catch (error) {\r\n        console.error('Detailed error in checkIsAdmin:', error);\r\n        return false;\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}